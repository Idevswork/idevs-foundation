<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <GeneratePackageOnBuild>true</GeneratePackageOnBuild>
    <PackageId>Idevs.Foundation</PackageId>
    <Title>Idevs Foundation</Title>
    <Description>Complete foundation framework for building modern .NET applications with CQRS, Entity Framework, Mediator patterns, and more</Description>
    <PackageTags>foundation;cqrs;entityframework;mediator;services;serilog;autofac;abstractions</PackageTags>
    
    <!-- Consolidated package configuration -->
    <IncludeBuildOutput>true</IncludeBuildOutput>
    <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
  </PropertyGroup>

  <!-- Include all Foundation components -->
  <ItemGroup>
    <ProjectReference Include="../Idevs.Foundation.Abstractions/Idevs.Foundation.Abstractions.csproj" PrivateAssets="all" />
    <ProjectReference Include="../Idevs.Foundation.Services/Idevs.Foundation.Services.csproj" PrivateAssets="all" />
    <ProjectReference Include="../Idevs.Foundation.Mediator/Idevs.Foundation.Mediator.csproj" PrivateAssets="all" />
    <ProjectReference Include="../Idevs.Foundation.Cqrs/Idevs.Foundation.Cqrs.csproj" PrivateAssets="all" />
    <ProjectReference Include="../Idevs.Foundation.EntityFramework/Idevs.Foundation.EntityFramework.csproj" PrivateAssets="all" />
    <ProjectReference Include="../Idevs.Foundation.Serilog/Idevs.Foundation.Serilog.csproj" PrivateAssets="all" />
    <ProjectReference Include="../Idevs.Foundation.Autofac/Idevs.Foundation.Autofac.csproj" PrivateAssets="all" />
  </ItemGroup>

  <!-- Include external NuGet package dependencies -->
  <ItemGroup>
    <!-- Microsoft Core Packages -->
    <PackageReference Include="Microsoft.Extensions.Logging.Abstractions" />
    <PackageReference Include="Microsoft.Extensions.DependencyInjection.Abstractions" />
    <PackageReference Include="Microsoft.Extensions.Configuration.Abstractions" />
    <PackageReference Include="Microsoft.Extensions.Hosting.Abstractions" />
    <PackageReference Include="Microsoft.Extensions.Caching.Memory" />
    
    <!-- Entity Framework Core -->
    <PackageReference Include="Microsoft.EntityFrameworkCore" />
    <PackageReference Include="Microsoft.EntityFrameworkCore.Relational" />
    
    <!-- Autofac -->
    <PackageReference Include="Autofac" />
    <PackageReference Include="Autofac.Extensions.DependencyInjection" />
    
    <!-- Serilog -->
    <PackageReference Include="Serilog" />
    <PackageReference Include="Serilog.Extensions.Logging" />
    <PackageReference Include="Serilog.Extensions.Hosting" />
    <PackageReference Include="Serilog.Sinks.Console" />
    <PackageReference Include="Serilog.Sinks.File" />
    <PackageReference Include="Serilog.Settings.Configuration" />
    <PackageReference Include="Serilog.Enrichers.Environment" />
    <PackageReference Include="Serilog.Enrichers.Process" />
    <PackageReference Include="Serilog.Enrichers.Thread" />
    
    <!-- System Packages -->
    <PackageReference Include="System.Text.Json" />
  </ItemGroup>

  <!-- Add documentation to package -->
  <ItemGroup>
    <None Include="README.md" Pack="true" PackagePath="\" />
  </ItemGroup>

  <!-- Custom target to include all project reference assemblies in the package -->
  <Target Name="IncludeReferencedProjectsInPack" BeforeTargets="_GetPackageFiles">
    <ItemGroup>
      <None Include="$(OutputPath)Idevs.Foundation.Abstractions.dll" Pack="true" PackagePath="lib/net8.0/" />
      <None Include="$(OutputPath)Idevs.Foundation.Services.dll" Pack="true" PackagePath="lib/net8.0/" />
      <None Include="$(OutputPath)Idevs.Foundation.Mediator.dll" Pack="true" PackagePath="lib/net8.0/" />
      <None Include="$(OutputPath)Idevs.Foundation.Cqrs.dll" Pack="true" PackagePath="lib/net8.0/" />
      <None Include="$(OutputPath)Idevs.Foundation.EntityFramework.dll" Pack="true" PackagePath="lib/net8.0/" />
      <None Include="$(OutputPath)Idevs.Foundation.Serilog.dll" Pack="true" PackagePath="lib/net8.0/" />
      <None Include="$(OutputPath)Idevs.Foundation.Autofac.dll" Pack="true" PackagePath="lib/net8.0/" />
    </ItemGroup>
  </Target>

</Project>
